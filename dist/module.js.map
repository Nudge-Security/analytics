{"mappings":"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","sources":["src/index.js"],"sourcesContent":["import Cookies from 'js-cookie'\nconst $ = require('jquery');\n\nexport function delete_utm_cookie() {\n    Cookies.remove('chocolate-chip')\n}\n\nexport function get_utm_cookie() {\n    let chocolate = Cookies.get('chocolate-chip');\n    if(chocolate){\n        return chocolate\n    }\n    return null\n}\n\nexport function get_hubspot_cookie() {\n    return Cookies.get('hubspotutk')\n}\n\nexport function setCookie(newList) {\n    Cookies.set('chocolate-chip',newList,{expires:7})\n}\nexport function endsWithDomain(referringHost, domains) {\n    for (const domain of domains) {\n        if (referringHost.toLowerCase().endsWith(domain)) {\n            return true\n        }\n    }\n    return false\n}\n\nexport function setIfUnset(newList, key, defaultValue) {\n    if (!newList.has(key)) {\n        newList.set(key, defaultValue)\n    }\n}\n\nexport function getURLSearchParamsForCookie() {\n    var newList = null;\n    var existingCookie = get_utm_cookie()\n    if (existingCookie) {\n        // if it exists then start from the existing values\n        newList = new URLSearchParams(existingCookie);\n    }\n    return newList;\n}\n\nexport function process_utm_data() {\n    var queryString = window.location.search;\n    // ?utm_source=facebook&utm_medium=post&utm_campaign=webflow\n    var URLSearchParams_wb = new URLSearchParams(queryString);\n\n    const utmParameters = [\n        \"utm_source\",\n        \"utm_medium\",\n        \"utm_content\",\n        \"utm_term\",\n        \"gclid\",\n        \"utm_campaign\"\n    ];\n    const socialDomains = [\n        \"facebook.com\",\n        \"twitter.com\",\n        \"instagram.com\",\n        \"whatsapp.com\",\n        \"tiktok.com\",\n        \"reddit.com\",\n        \"linkedin.com\",\n        \"vk.com\",\n        \"discord.com\",\n        \"pinterest.com\"\n    ];\n    const searchDomains = [\n        \"google.com\",\n        \"baidu.com\",\n        \"yandex.ru\",\n        \"bing.com\",\n        \"duckduckgo.com\",\n        \"daum.net\",\n        \"seznam.cz\",\n        \"sogou.com\",\n        \"sm.cn\",\n        \"ecosia.org\"\n    ];\n    const productDomains = [\n        \"nudgesecurity.io\"\n    ]\n\n    var newList = new URLSearchParams();\n\n    var existing = getURLSearchParamsForCookie();\n    if (existing){\n        newList = existing\n    }\n    for (const utm_element of utmParameters) {\n        var value = URLSearchParams_wb.get(utm_element)\n        if (value) {\n            newList.set(utm_element, value)\n        }\n    }\n\n\n\n    var default_utm_source = \"direct\"\n    var default_utm_content = \"not_provided\"\n    var default_utm_medium = 'direct'\n    var default_utm_campaign = 'brand'\n\n    var currentUrl = new URL(window.location)\n    if (document.referrer) {\n        //if we can't place referrer than default to referrer\n        default_utm_medium = 'referral'\n        default_utm_campaign = 'not_provided'\n        let referrer = new URL(document.referrer);\n        var referringHost = referrer.host;\n        newList.set('referring_domain', referringHost)\n        // default content to not_provided\n        default_utm_content = 'not_provided'\n        // default source to referring domain\n        default_utm_source = referringHost\n        if (endsWithDomain(referringHost, searchDomains)) {\n            default_utm_medium = 'organic_search';\n            if (currentUrl.pathname === '/') {\n                default_utm_campaign = 'brand'\n            } else {\n                default_utm_campaign = 'not_provided'\n            }\n        } else if (endsWithDomain(referringHost, socialDomains)) {\n            default_utm_medium = 'organic_social';\n            default_utm_content = 'not_provided'\n            default_utm_campaign = 'earned'\n        } else if (endsWithDomain(referringHost, productDomains)) {\n            default_utm_medium = 'product';\n            default_utm_content = 'not_provided'\n            if (referringHost === 'mail.nudgesecurity.io') {\n                default_utm_source = 'email'\n            } else {\n                default_utm_source = 'ui'\n            }\n        }\n    }\n    setIfUnset(newList, 'utm_medium', default_utm_medium)\n    setIfUnset(newList, 'utm_source', default_utm_source)\n    setIfUnset(newList, 'utm_content', default_utm_content)\n    setIfUnset(newList, 'utm_campaign', default_utm_campaign)\n    setIfUnset(newList, 'utm_term', 'not_provided')\n    var landing_url = currentUrl.pathname\n    if (landing_url === '/'){\n        landing_url = 'home'\n    }\n    newList.set('landing_url', landing_url)\n    setCookie(newList);\n}\nexport function processHrefTrialParams(element) {\n    var href = element.getAttribute('href');\n    if (href) {\n        var url = new URL(href);\n        url.searchParams.set(\"freeTrial\", true);\n        if (analytics) {\n            let user = analytics.user();\n            if (user) {\n                url.searchParams.set(\"ajs_aid\", user.anonymousId());\n            }\n        }\n        var hub = get_hubspot_cookie()\n        if (hub && hub !== '') {\n            url.searchParams.set(\"hub\", hub);\n        }\n        var utm_cookie = get_utm_cookie()\n        if (utm_cookie) {\n            var cached = new URLSearchParams(utm_cookie);\n            for (const key of cached.keys()) {\n                url.searchParams.set(key, cached.get(key))\n            }\n        }\n        element.setAttribute('href', url.href);\n    }\n}\n\nexport function selectAndUpdateTrialButtons() {\n    $('[trial-button]').each(function() {\n        processHrefTrialParams($(this)[0]);\n        $(this).on('click', () => {\n            delete_utm_cookie();\n        })\n    });\n}\nexport function selectAndUpdateDataAnalytics(){\n    $('[data-analytics]').on('click', function(e) {\n        var properties\n        var event = $(this).attr('data-analytics')\n        $.each(this.attributes, function(_, attribute) {\n            if (attribute.name.startsWith('data-property-')) {\n                if (!properties) properties = {}\n                var property = attribute.name.split('data-property-')[1]\n                properties[property] = attribute.value\n            }\n        })\n        analytics.track(event, properties)\n    });\n}"],"names":["Cookies","$","require","delete_utm_cookie","remove","get_utm_cookie","chocolate","get","get_hubspot_cookie","setCookie","newList","set","expires","endsWithDomain","referringHost","domains","domain","toLowerCase","endsWith","setIfUnset","key","defaultValue","has","getURLSearchParamsForCookie","existingCookie","URLSearchParams","process_utm_data","queryString","window","location","search","URLSearchParams_wb","utmParameters","socialDomains","searchDomains","productDomains","existing","utm_element","value","default_utm_source","default_utm_content","default_utm_medium","default_utm_campaign","currentUrl","URL","document","referrer","host","pathname","landing_url","processHrefTrialParams","element","href","getAttribute","url","searchParams","analytics","user","anonymousId","hub","utm_cookie","cached","keys","setAttribute","selectAndUpdateTrialButtons","each","on","selectAndUpdateDataAnalytics","e","properties","event","attr","attributes","_","attribute","name","startsWith","property","split","track"],"version":3,"file":"module.js.map"}